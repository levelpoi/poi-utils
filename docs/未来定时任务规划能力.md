以下是一个用于 Agent 提示词的协议定义，旨在规范未来规划、定时或延迟触发任务的 JSON 格式。该协议可用于 AI Agent 接收、解析和执行带有时间约束的任务指令。

---

### 📜 **Agent 定时/延迟任务触发协议（Future Planning & Scheduled Task Protocol）**

#### 1. **协议目的**
定义一种标准化的 JSON 格式，用于向 AI Agent 下达未来执行的定时或延迟任务，支持绝对时间（定时）和相对时间（延迟）触发。

---

#### 2. **JSON 格式结构**

```json
{
  "task_id": "string, 可选，任务唯一标识符",
  "task_type": "string, 必填，任务类型，如 'reminder', 'action', 'planning', 'notification'",
  "description": "string, 必填，任务描述",
  "trigger": {
    "type": "string, 必填，触发类型：'scheduled'（定时）或 'delayed'（延迟）",
    "time": "string, 必填，ISO 8601 时间格式（定时）或持续时间（延迟）",
    "timezone": "string, 可选，时区（如 'Asia/Shanghai'），默认为系统时区"
  },
  "payload": {
    "action": "string, 必填，要执行的动作，如 'send_email', 'notify_user', 'run_script'",
    "parameters": {
      "key": "value, 可选，动作所需参数"
    }
  },
  "repeat": {
    "enabled": "boolean, 可选，默认 false",
    "interval": "string, 可选，ISO 8601 重复间隔，如 'P1D'（每天）、'PT1H'（每小时）",
    "count": "integer, 可选，最大重复次数，null 表示无限"
  },
  "priority": "string, 可选，优先级：'low', 'medium', 'high', 'urgent'",
  "context": {
    "source": "string, 可选，任务来源，如 'user_input', 'system_event'",
    "related_goal": "string, 可选，关联的长期目标或计划 ID"
  }
}
```

---

#### 3. **字段说明**

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `task_id` | string | 否 | 唯一标识任务，便于后续查询或取消 |
| `task_type` | string | 是 | 任务分类，便于 Agent 路由处理 |
| `description` | string | 是 | 人类可读的任务描述 |
| `trigger.type` | string | 是 | `scheduled` 表示在指定时间触发；`delayed` 表示从现在起延迟一段时间触发 |
| `trigger.time` | string | 是 | 若为 `scheduled`，使用 ISO 8601（如 `"2025-04-05T08:00:00"`）；若为 `delayed`，使用 ISO 8601 持续时间（如 `"PT30M"` 表示30分钟后） |
| `trigger.timezone` | string | 否 | 时区标识，如 `"America/New_York"`，默认使用系统时区 |
| `payload.action` | string | 是 | 具体要执行的动作 |
| `payload.parameters` | object | 否 | 动作所需的参数对象 |
| `repeat.enabled` | boolean | 否 | 是否重复执行 |
| `repeat.interval` | string | 否 | ISO 8601 重复周期，如 `P1D`（每天）、`PT2H30M`（每2小时30分钟） |
| `repeat.count` | integer | 否 | 最大重复次数，`null` 或省略表示无限 |
| `priority` | string | 否 | 任务优先级，用于调度排序 |
| `context.source` | string | 否 | 任务来源，用于审计或反馈 |
| `context.related_goal` | string | 否 | 关联的长期目标或计划 ID |

---

#### 4. **示例**

##### 示例 1：30 分钟后提醒用户
```json
{
  "task_id": "remind-meeting-001",
  "task_type": "reminder",
  "description": "提醒用户参加30分钟后会议",
  "trigger": {
    "type": "delayed",
    "time": "PT30M"
  },
  "payload": {
    "action": "notify_user",
    "parameters": {
      "message": "您的会议将在30分钟后开始，请准备。",
      "channel": "popup"
    }
  },
  "priority": "high"
}
```

##### 示例 2：每天早上8点发送日报（定时 + 重复）
```json
{
  "task_id": "daily-report-001",
  "task_type": "action",
  "description": "每天上午8点自动发送日报邮件",
  "trigger": {
    "type": "scheduled",
    "time": "2025-04-05T08:00:00",
    "timezone": "Asia/Shanghai"
  },
  "payload": {
    "action": "send_email",
    "parameters": {
      "to": "team@company.com",
      "subject": "每日工作简报",
      "body": "请查收今日工作汇总。"
    }
  },
  "repeat": {
    "enabled": true,
    "interval": "P1D",
    "count": null
  },
  "priority": "medium"
}
```

##### 示例 3：2小时后执行脚本（延迟任务）
```json
{
  "task_id": "backup-script-001",
  "task_type": "planning",
  "description": "延迟2小时执行数据备份脚本",
  "trigger": {
    "type": "delayed",
    "time": "PT2H"
  },
  "payload": {
    "action": "run_script",
    "parameters": {
      "script_path": "/scripts/backup.sh",
      "args": ["--full"]
    }
  }
}
```

---

#### 5. **支持的时间格式说明**

- **ISO 8601 时间点**（用于 `scheduled`）：
  - `2025-04-05T08:00:00`
  - 支持毫秒：`2025-04-05T08:00:00.000`
- **ISO 8601 持续时间**（用于 `delayed`）：
  - `PT30M`：30分钟
  - `PT1H30M`：1小时30分钟
  - `P2D`：2天后
  - `PT5S`：5秒后

---

#### 6. **Agent 处理逻辑建议**

1. 解析 `trigger.type` 和 `time`，计算出绝对触发时间。
2. 若为 `delayed`，以当前时间为基准加上持续时间。
3. 将任务加入调度队列，按 `priority` 和触发时间排序。
4. 触发时执行 `payload.action`，并传入 `parameters`。
5. 若 `repeat.enabled` 为 `true`，按 `interval` 计算下一次触发时间，直到达到 `count` 次。

---

#### 7. **扩展建议**

- 支持 `cancel_on_event` 字段：在特定事件发生时取消任务。
- 支持 `conditions` 字段：仅在满足条件时才触发任务（如“仅当网络连接时”）。

---

✅ 该协议可用于多模态 Agent 系统中的任务调度模块，确保未来任务的标准化表达与可靠执行。




### 范例

当前识别到上一条信息中包含“天”等信息，你可以判断是否需要进行未来任务设置

用户的输入 ：【我明天想去吃萨莉亚，啊啊啊】

如果有需要，返回格式即可
{
  "task_id": "string, 可选，任务唯一标识符",
  "task_type": "string, 必填，任务类型，如 'reminder', 'action', 'planning', 'notification'",
  "description": "string, 必填，任务描述",
  "trigger": {
    "type": "string, 必填，触发类型：'scheduled'（定时）或 'delayed'（延迟）",
    "time": "string, 必填，ISO 8601 时间格式（定时）或持续时间（延迟）",
    "timezone": "string, 可选，时区（如 'Asia/Shanghai'），默认为系统时区"
  },
  "payload": {
    "action": "string, 必填，要执行的动作，如 'send_email', 'notify_user', 'run_script'",
    "parameters": {
      "key": "value, 可选，动作所需参数"
    }
  },
  "repeat": {
    "enabled": "boolean, 可选，默认 false",
    "interval": "string, 可选，ISO 8601 重复间隔，如 'P1D'（每天）、'PT1H'（每小时）",
    "count": "integer, 可选，最大重复次数，null 表示无限"
  },
  "priority": "string, 可选，优先级：'low', 'medium', 'high', 'urgent'",
  "context": {
    "source": "string, 可选，任务来源，如 'user_input', 'system_event'",
    "related_goal": "string, 可选，关联的长期目标或计划 ID"
  }
}


### 返回

{
  "task_id": "reminder_salya_visit",
  "task_type": "reminder",
  "description": "提醒用户明天去吃萨莉亚",
  "trigger": {
    "type": "scheduled",
    "time": "2025-04-06T10:00:00",
    "timezone": "Asia/Shanghai"
  },
  "payload": {
    "action": "notify_user",
    "parameters": {
      "message": "今天你计划去吃萨莉亚，记得出发哦！"
    }
  },
  "priority": "medium",
  "context": {
    "source": "user_input",
    "related_goal": null
  }
}